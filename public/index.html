
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>weatheredwatcher</title>
  <meta name="author" content="weatheredwatcher">

  
  <meta name="description" content="Recently I have been moving more and more away from development and more into System Administration. Still, my skills and experience in programming &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://www.weatheredwatcher.com/">
  <link href="/favicon.ico" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="weatheredwatcher" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:www.weatheredwatcher.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
    <li><a href="/">
        <span class="blue_light">
            weatheredwatcher
        </span>
       
           <span id="sub-title" class="blue_dark">
             ...creating chaos since 1981
           </span>
       
    </a></li>
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/about">About me</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/08/23/server-stuff-a-developer-needs-to-know/">Server Stuff a Developer Needs to Know (Part 1)</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-08-23T00:11:28-04:00" pubdate data-updated="true">Aug 23<span>rd</span>, 2014</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Recently I have been moving more and more away from development and more into System Administration.  Still, my skills and experience in programming
means that I also have a good handle on developers. So I have been making a effort to move in the direction of DevOps.  I do some consultation work for
a startup that is currently coming out of the USC Incubator.  I mostly contribute as the Architect and help provide direction to the infrastructure and
coding best practices as well as run their servers.  So this fits perfectly in the role of DevOps.  One of the things that has really begun to frustrate me
is the lack of BASIC linux skills in developers that should know better.  I am not asking you to setup a fucking mail server or configure a load balancer.
I can do those things just fine without your help.  But there are certain things that a developer NEEDS to know how to do. So, here is the first in a series of posts
on some things that in my humble opinion a developer should be able to do without me holding their goddamn hand!</p>

<h2>Logging into and Deploying Code to a Server</h2>

<p>Guys, this is not that hard.  First of all: A secure server should be using ssh &mdash; NOT ftp.  Do not ask me for FTP access to my server.  I will not
give it to you.  No matter how many times you ask me to.</p>

<p>You can connect to a server using ssh like this:</p>

<pre><code>ssh username@hostname
</code></pre>

<p>If you do not want to use a password, or if I decide not to give you one, you will need to provide me with a public key.  It is fairly easy.  On a
Linux/Unix system, in the termianl type:</p>

<pre><code>ssh-keygen -t rsa -f ~/.ssh/id_rsa
</code></pre>

<p>This will give you a key pair. Email me the one with the .pub extension</p>

<pre><code>id_rsa.pub
</code></pre>

<p>Running Windows?  Either install git and use git-bash or install Cygwin and run the Bash shell.  The above commands will work for you too.</p>

<p>Then you should be able to log in without a password.   Having issues?</p>

<pre><code>ssh user@hostname -i ~/.ssh/id_rsa.pub
</code></pre>

<p>Rather do it yourself? Once you have logged in to the server with your given user name, you can add your key to the authorized_keys file.</p>

<p>It needs to be in a file called  ~/.ssh/authorized_keys</p>

<p>Now on to deployment.  Most of the time there is going to be some procedure in place for production deployments, but not so much on a dev server.
You should be able to upload your code to the server. Aside from using git, which is just easy, I personally like secure copy or scp.  It is fairly simple to use,
especially if you already have a key setup on the remote server.  The syntax is easy:</p>

<pre><code>scp -r localfolder/ user@remotehost:/path/to/server
</code></pre>

<p>If you would rather use rsync:</p>

<pre><code>rsync -r localfolder/ user@remotehost:/path/to/server
</code></pre>

<p>It&rsquo;s not rocket science people!  Learn some basic Linux!</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/08/07/devops-building-projects-with-ant/">DevOps: Bulding Projects With Ant</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-08-07T10:46:00-04:00" pubdate data-updated="true">Aug 7<span>th</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I&rsquo;ve been running a build process for an application that I am working on that is rather complicated.  Originally I was manually managing the build process, with a few scripts to supplement my procedures.  The past few days I have finally had the time to sit down and consolidate my build into a single ant script.  The company that I am contracting for is a heavy Java shop, so I am using Ant mostly because everyone will have access to ant.  I am use to make so it&rsquo;s been a bit of a learning curve, but Ant is a very cool thing.  So, for starters, let me outline my current build process and then I will show you how I have automated it.</p>

<ol>
<li>We pull the code from the QA branch in GitHub</li>
<li>Run Composer over the code to install all the dependencies</li>
<li>We tag the build with a version tag</li>
<li>We write the version tag and the date to a version file</li>
<li>We tar up ONLY the files that are absolutely needed to run the application (we have tools, docs, ect that we do not need)</li>
<li>We send the final archive to the server team for deployment</li>
</ol>


<p>Actually, I started using Ant early on for the final tar build.  Ant has a great task for tar.  Here is the target for that.</p>

<pre><code>&lt;target name="deploy"&gt;
      &lt;tar destfile="deploy.tar"
           basedir="build/"   
           excludes="build/**, database/**, docs/**.vagrant/**"/&gt;

&lt;/target&gt;
</code></pre>

<p>This essentially creates a file called <code>deploy.tar</code> in a sub-folder called <code>build/</code>.  It excludes anything already in <code>build/</code> as well as <code>database/</code>, <code>docs/', and</code>.vagrant&#8217;.  Obviously I truncated my list&hellip;it is a lot longer in reality!  A lot of files sit in the root like the <code>Vagrantfile</code>, a <code>Makefile</code> the files for composer.</p>

<p>So this is about the final step.  But I still need to automate the rest.</p>

<p>The first step is grabbing my code from GitHub.  Eclipse offers a task for any that is based on jgit.  You need a few dependencies for this to work.  Namely the jgit class file and the jgit-ant class file.  You also need the ssh library, which I was already using for some other scripts.</p>

<p>You need to load them as resources, which is done like so:</p>

<pre><code>&lt;taskdef resource="org/eclipse/jgit/ant/ant-tasks.properties"&gt;
     &lt;classpath&gt;
       &lt;pathelement location="resources/org.eclipse.jgit.ant-3.0.0.2013061825-r.jar"/&gt;
       &lt;pathelement location="resources/org.eclipse.jgit-3.0.0.2013061825-r.jar"/&gt;
       &lt;pathelement location="../jsch-0.1.49.jar"/&gt;
     &lt;/classpath&gt;
&lt;/taskdef&gt;
</code></pre>

<p>Then we set up the task for cloning:</p>

<pre><code>&lt;target name="clone"&gt;
     &lt;git-clone 
         uri="git@github.com:weatheredwatcher/weatheredwatcher.git" 
         branch="testing"
         dest="build/" /&gt;
&lt;/target&gt;
</code></pre>

<p>(Note that I am using this site rather then the project that I am working on&hellip;)</p>

<p>The next step is running Composer.  For those that do not know, Composer is a dependency management tool for PHP.  We are loading several dependencies as well as some custom libs via composer so it is important that we generate the right files.</p>

<pre><code>&lt;target name="init" description="Installing Denpendencies"&gt;
  &lt;delete file="build/composer.lock" /&gt;

    &lt;exec executable="php" failonerror="true"
        dir="build/"&gt;
        &lt;arg value="composer.phar" /&gt;
        &lt;arg value="install" /&gt;
  &lt;/exec&gt;

&lt;/target&gt;
</code></pre>

<p>So what we are doing here is first we delete the lock file. Typically the devs install a few extra tools that are not needed on the QA server.  So we remove the lock file and then only install the production level requirements with Composer.  <code>failonerror</code> ensure that we get an error if anything bad happens rather then a success.</p>

<p>As far as tagging goes, I feel it is better to do the tagging in GitHub rather then in the build process.  So we will only be writing to a version file.  We need to write the current tag as well as the build date to this file.  The git command for displaying the current tag is <code>git describe --exact-match --abbrev=0</code>.  We antify this like so:</p>

<pre><code>&lt;exec executable="git" failonerror="true"
   dir="build/"&gt;
   &lt;arg value="describe" /&gt;
   &lt;arg value="--exact-match" /&gt;
   &lt;arg value="--abbrev=0" /&gt;
   &lt;redirector output="build/version" /&gt;
&lt;/exec&gt;
</code></pre>

<p>The last part was hard.  You cannot pass a redirect <code>&gt;</code> through the <code>exec</code> task.  Instead, we use the <code>redirector</code>.  The date is similar, but we add an append option to the redirector to make sure we do not overwrite the file.</p>

<pre><code>&lt;exec executable="date" dir="build/"&gt;
  &lt;redirector output="build/version" append="true"/&gt;
&lt;/exec&gt;  
</code></pre>

<p>So if we put it all together into a massive ant script, we have nearly the entire deploy build.  The last part is the one where we send it along to the Server Team&rsquo;s folders via a mount and a copy.</p>

<p>The final thing to do is to clean up.</p>

<pre><code>&lt;target name="clean"&gt;
    &lt;delete dir="build"/&gt;
&lt;/target&gt;
</code></pre>

<p>My next step will be taking this process and integrating it into a Hudson build for Continuous Integration or CI.  Obviously, Hudson will be able to take on a lot of this functionality without any ant scripts&hellip;but I also can just have Hudson run the ant script if I want.  We will see.  Until then, happy coding!!</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/07/02/using-zend-config-files-everywhere/">Using Zend Style Config Files Everywhere</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-07-02T10:46:00-04:00" pubdate data-updated="true">Jul 2<span>nd</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>It&rsquo;s been a while since my last blog entry, I know!!  I feel bad, so here is a bit of php goodness to make us all feel better!</p>

<p>It&rsquo;s always a good security practice to remove configuration from your web-app.  One way to do this is to use a configuration file.  Now, Zend has a very cool way of doing this,(<code>Zend\Config\Reader</code>) but the client that I am with right now is using a solution based on Codeigniter.  However, since they are planning on eventually moving to Zend anyway, I figured I would implement a solution based on the Zend config solution.</p>

<p>First comes the file, which I called <code>environment.ini</code> and placed in <code>/etc</code>.</p>

<p>The entries are in the following format:</p>

<pre><code>cg.database.name=name
cg.database.username=username
cg.database.password=password
cg.database.hostname=hostname
cg.services.name=dev
cg.services.port=8080
</code></pre>

<p>To utilize this for the database, for example, lets create a helper with the following function:</p>

<pre><code>function get_environment(){
$config = array();
foreach( file( '/etc/sitename/environment.ini') as $line) {
    list( $keys, $value) = explode( '=', $line);

    $temp =&amp; $config;
    foreach( explode( '.', $keys) as $key)
    {           
        $temp =&amp; $temp[$key];
    }
    $temp = trim( $value);

}

return $config;

}
</code></pre>

<p>This will return an array like this:</p>

<pre><code>array 
  'cg' =&gt; 
    array 
     'database' =&gt; 
        array 
          'name' =&gt; string 'name'
          'hostname' =&gt; string 'hostname'
          'username' =&gt; string 'username'
          'password' =&gt; string 'password' 
      'services' =&gt; 
        array (size=5)
          'url' =&gt; string 'dev'
          'port' =&gt; string '8080'
</code></pre>

<p>The next part of this is making use of the data in your application.  In the database config file for Codeigniter, for example:</p>

<pre><code>$dbconfig = get_environment();

$db = $dbconfig['cg'][database];

$db['default']['hostname'] = $db['hostname'];
$db['default']['username'] = $db['username'];
$db['default']['password'] = $db['password'];
$db['default']['database'] = $db['name'];
</code></pre>

<p>And there you have it!  Of course, I based this on CI but you should be able to use this code for any framework..or even no framework.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/02/01/preparing-a-dev-environment-with-puppet/">Preparing a Dev Environment With Puppet</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-02-01T00:00:00-05:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>For starts, I now have markup installed in my blog, so no more typing html!! Yea!\n
Today we are going to talk about Puppet.  No, not Pinochio, or those Punch and Judy dolls.  This is Puppet as in the server provisioning tool.</p>

<p>At work I am setting up a development environment for our dev team.  Since most of them are just learning php, and for over all consistency I am using Vagrant to build a standard dev vm for everyone to work off of.</p>

<p>The general requirements are simple:</p>

<ol>
<li>We must run Zend Server</li>
<li>We must load the php drivers MS Sql</li>
<li>We must install subversion</li>
</ol>


<p>With these requirements in mind, I set out to build my first puppet script.</p>

<p>The first class that we define is our services class.  I need to make sure that Apache is running.  Also, I found out that Cent Os turns iptables on by default.  That interferes with the dev box, as well as being unnecessary!  So we make sure that iptables is off.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>class services {
</span><span class='line'>  #we want apache
</span><span class='line'>  service {
</span><span class='line'>    'httpd':
</span><span class='line'>      ensure =&gt; running,
</span><span class='line'>      enable =&gt; true
</span><span class='line'>  }
</span><span class='line'>
</span><span class='line'>service {
</span><span class='line'>  'iptables':
</span><span class='line'>    ensure =&gt; stopped,
</span><span class='line'>    enable =&gt; false
</span><span class='line'> }
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p>The next two classes work in tandem.  The repos class defines our Zend Server repo and packages install the required packages.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>class packages {
</span><span class='line'>  package {
</span><span class='line'>    "httpd":                      ensure =&gt; "present"; # Apache
</span><span class='line'>    "subversion":                 ensure =&gt; "present"; # Subversion
</span><span class='line'>    "zend-server-ce-php-5.3":     ensure =&gt; "present"; # Zend Server (CE)
</span><span class='line'>    "php-5.3-mssql-zend-server":  ensure =&gt; "present"; # MSSQL Extenstion - provided by Zend
</span><span class='line'>  }
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>class repos {
</span><span class='line'>  #lets install some repos
</span><span class='line'>  file { "/etc/yum.repos.d/zend.repo":
</span><span class='line'>    content =&gt; "[Zend]
</span><span class='line'>    name=Zend Server
</span><span class='line'>    baseurl=http://repos.zend.com/zend-server/rpm/x86_64
</span><span class='line'>    enabled=1
</span><span class='line'>    gpgcheck=1
</span><span class='line'>    gpgkey=http://repos.zend.com/zend.key
</span><span class='line'>
</span><span class='line'>    [Zend_noarch]
</span><span class='line'>    name=Zend Server - noarch
</span><span class='line'>    baseurl=http://repos.zend.com/zend-server/rpm/noarch
</span><span class='line'>    enabled=1
</span><span class='line'>    gpgcheck=1
</span><span class='line'>    gpgkey=http://repos.zend.com/zend.key
</span><span class='line'>    "
</span><span class='line'>  }
</span><span class='line'>
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p>If anyone wants to see the entire file, here it is:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>stage {
</span><span class='line'>
</span><span class='line'>  'users':      before =&gt; Stage['repos'];
</span><span class='line'>  'repos':      before =&gt; Stage['packages'];
</span><span class='line'>  'packages':   before =&gt; Stage['configure'];
</span><span class='line'>  'configure':  before =&gt; Stage['services'];
</span><span class='line'>  'services':   before =&gt; Stage['main'];
</span><span class='line'>
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>class services {
</span><span class='line'>  #we want apache
</span><span class='line'>  service {
</span><span class='line'>    'httpd':
</span><span class='line'>      ensure =&gt; running,
</span><span class='line'>      enable =&gt; true
</span><span class='line'>  }
</span><span class='line'>
</span><span class='line'>  service {
</span><span class='line'>    'iptables':
</span><span class='line'>      ensure =&gt; stopped,
</span><span class='line'>      enable =&gt; false
</span><span class='line'>  }
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>class configure {
</span><span class='line'>
</span><span class='line'>  # symlinking the code from /home/vagrant/public to var/www/public
</span><span class='line'>  exec { "public simlink":
</span><span class='line'>    command =&gt; "/bin/ln -s /home/vagrant/public /var/www/",
</span><span class='line'>    unless  =&gt; "/usr/bin/test -L /var/www/",
</span><span class='line'>  }
</span><span class='line'>  file {"/var/www/index.html":
</span><span class='line'>    ensure =&gt; "absent"
</span><span class='line'>
</span><span class='line'>  }
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>class packages {
</span><span class='line'>  package {
</span><span class='line'>    "httpd":                      ensure =&gt; "present"; # Apache
</span><span class='line'>    "subversion":                 ensure =&gt; "present"; # Subversion
</span><span class='line'>    "zend-server-ce-php-5.3":     ensure =&gt; "present"; # Zend Server (CE)
</span><span class='line'>    "php-5.3-mssql-zend-server":  ensure =&gt; "present"; # MSSQL Extenstion - provided by Zend
</span><span class='line'>  }
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>class repos {
</span><span class='line'>
</span><span class='line'>  file { "/etc/yum.repos.d/zend.repo":
</span><span class='line'>    content =&gt; "[Zend]
</span><span class='line'>name=Zend Server
</span><span class='line'>baseurl=http://repos.zend.com/zend-server/rpm/x86_64
</span><span class='line'>enabled=1
</span><span class='line'>gpgcheck=1
</span><span class='line'>gpgkey=http://repos.zend.com/zend.key
</span><span class='line'>
</span><span class='line'>[Zend_noarch]
</span><span class='line'>name=Zend Server - noarch
</span><span class='line'>baseurl=http://repos.zend.com/zend-server/rpm/noarch
</span><span class='line'>enabled=1
</span><span class='line'>gpgcheck=1
</span><span class='line'>gpgkey=http://repos.zend.com/zend.key
</span><span class='line'>    "
</span><span class='line'>  }
</span><span class='line'>
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>class users
</span><span class='line'>{
</span><span class='line'>  group { "puppet":
</span><span class='line'>    ensure =&gt; "present",
</span><span class='line'>  }
</span><span class='line'>  user { "vagrant":
</span><span class='line'>    ensure =&gt; "present",
</span><span class='line'>
</span><span class='line'>  }
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>class {
</span><span class='line'>  users:      stage =&gt; "users";
</span><span class='line'>  repos:      stage =&gt; "repos";
</span><span class='line'>  packages:   stage =&gt; "packages";
</span><span class='line'>  configure:  stage =&gt; "configure";
</span><span class='line'>  services:   stage =&gt; "services";
</span><span class='line'>
</span><span class='line'>  }</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/01/24/running-multiple-apps-on-nodejs/">Running Multiple Apps on NodeJs</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-01-24T00:00:00-05:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>So, what I am wanting to so is to be able to run multiple apps on Nodejs.  Specifically, I want to be able to use node-static to server static files and some other app (yet to be determined) to server up my blog as flat files.  I&rsquo;ve done this before in Ruby using Rack and Sinatra&hellip;so I figure I would give Nodejs&rsquo;s Bogart a try!\n
With a little bit of trial and error, I have come up with the best solution to this: Http-Proxy.</p>

<p>The first thing to look at will be my packages.json file.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='json'><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;bogart-test&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="nt">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;Testing Bogart/FlatFile/Static structures&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="nt">&quot;version&quot;</span><span class="p">:</span> <span class="s2">&quot;0.1.0&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="nt">&quot;author&quot;</span><span class="p">:</span> <span class="s2">&quot;David Duggins&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="nt">&quot;email&quot;</span><span class="p">:</span> <span class="s2">&quot;David Duggins&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="nt">&quot;main&quot;</span><span class="p">:</span> <span class="s2">&quot;./app&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="nt">&quot;directories&quot;</span><span class="p">:</span> <span class="p">{</span> <span class="nt">&quot;lib&quot;</span><span class="p">:</span> <span class="s2">&quot;./lib&quot;</span> <span class="p">},</span>
</span><span class='line'>    <span class="nt">&quot;dependencies&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span class='line'>      <span class="nt">&quot;node-static&quot;</span><span class="p">:</span> <span class="s2">&quot;&gt;=0.6.5&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="nt">&quot;bogart&quot;</span><span class="p">:</span> <span class="s2">&quot;&gt;=0.2.0&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="nt">&quot;mustache&quot;</span><span class="p">:</span> <span class="s2">&quot;0.3.1-dev&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="nt">&quot;http-proxy&quot;</span><span class="p">:</span> <span class="s2">&quot;&gt;=0.0.0&quot;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>The important stuff to note is node-static, bogart and node-static. I have not started to use mustache yet, but that may or may not be the templating engine.</p>

<p>Bogart by itself is fairly straight-forward.  It&rsquo;s just as easy to configure as Sinatra is for Ruby or Silex for php.  It&rsquo;s just handles routes.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='json'><span class='line'><span class="err">var</span> <span class="err">bogart</span> <span class="err">=</span> <span class="err">require(&#39;bogart&#39;);</span>
</span><span class='line'><span class="err">var</span> <span class="err">router</span> <span class="err">=</span> <span class="err">bogart.router();</span>
</span><span class='line'>
</span><span class='line'><span class="err">router.get(&#39;/&#39;,</span> <span class="err">function(req)</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>  <span class="err">return</span> <span class="err">bogart.html(</span><span class="nt">&quot;hello world&quot;</span><span class="err">);</span>
</span><span class='line'><span class="p">}</span><span class="err">);</span>
</span><span class='line'>
</span><span class='line'><span class="err">var</span> <span class="err">app</span> <span class="err">=</span> <span class="err">bogart.app();</span>
</span><span class='line'><span class="err">app.use(bogart.batteries);</span> <span class="err">//</span> <span class="err">A</span> <span class="err">batteries</span> <span class="err">included</span> <span class="err">JSGI</span> <span class="err">stack</span> <span class="err">including</span> <span class="err">streaming</span> <span class="err">request</span> <span class="err">body</span> <span class="err">parsing,</span> <span class="err">session,</span> <span class="err">flash,</span> <span class="err">and</span> <span class="err">much</span> <span class="err">more.</span>
</span><span class='line'><span class="err">app.use(router);</span> <span class="err">//</span> <span class="err">Our</span> <span class="err">router</span>
</span><span class='line'>
</span><span class='line'><span class="err">app.start();</span>
</span></code></pre></td></tr></table></div></figure>


<p> The above example with simply echo &ldquo;Hello World&rdquo; on the index of our site.  It is set to use the default port 8080.  That cam be easily changed with     app.start(&lsquo;10000&rsquo;, &lsquo;127.0.0.1&rsquo;)</p>

<p> The next part is node-static.  I want to be able to serve static files, like an about page.  Fairly simple as well:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class='json'><span class='line'><span class="err">var</span> <span class="err">static</span> <span class="err">=</span> <span class="err">require(&#39;node-static&#39;);</span>
</span><span class='line'>
</span><span class='line'><span class="err">//</span>
</span><span class='line'><span class="err">//</span> <span class="err">Create</span> <span class="err">a</span> <span class="err">node-static</span> <span class="err">server</span> <span class="err">to</span> <span class="err">serve</span> <span class="err">the</span> <span class="err">current</span> <span class="err">directory</span>
</span><span class='line'><span class="err">//</span>
</span><span class='line'><span class="err">var</span> <span class="err">file</span> <span class="err">=</span> <span class="err">new(static.Server)(&#39;.&#39;,</span> <span class="p">{</span> <span class="err">cache:</span> <span class="err">7200,</span> <span class="err">headers:</span> <span class="err">{&#39;X-Hello&#39;:&#39;World!&#39;</span><span class="p">}</span> <span class="err">});</span>
</span><span class='line'>
</span><span class='line'><span class="err">require(&#39;http&#39;).createServer(function</span> <span class="err">(request,</span> <span class="err">response)</span> <span class="p">{</span>
</span><span class='line'>    <span class="err">request.addListener(&#39;end&#39;,</span> <span class="err">function</span> <span class="err">()</span> <span class="err">{</span>
</span><span class='line'>        <span class="err">//</span>
</span><span class='line'>        <span class="err">//</span> <span class="err">Serve</span> <span class="err">files!</span>
</span><span class='line'>        <span class="err">//</span>
</span><span class='line'>        <span class="err">file.serve(request,</span> <span class="err">response,</span> <span class="err">function</span> <span class="err">(err,</span> <span class="err">res)</span> <span class="err">{</span>
</span><span class='line'>            <span class="err">if</span> <span class="err">(err)</span> <span class="err">{</span> <span class="err">//</span> <span class="err">An</span> <span class="err">error</span> <span class="err">as</span> <span class="err">occured</span>
</span><span class='line'>                <span class="err">console.error(</span><span class="nt">&quot;&gt; Error serving &quot;</span> <span class="err">+</span> <span class="err">request.url</span> <span class="err">+</span> <span class="s2">&quot; - &quot;</span> <span class="err">+</span> <span class="err">err.message);</span>
</span><span class='line'>                <span class="err">response.writeHead(err.status</span><span class="p">,</span> <span class="err">err.headers);</span>
</span><span class='line'>                <span class="err">response.end();</span>
</span><span class='line'>            <span class="p">}</span> <span class="err">else</span> <span class="p">{</span> <span class="err">//</span> <span class="err">The</span> <span class="err">file</span> <span class="err">was</span> <span class="err">served</span> <span class="err">successfully</span>
</span><span class='line'>                <span class="err">console.log(</span><span class="nt">&quot;&gt; &quot;</span> <span class="err">+</span> <span class="err">request.url</span> <span class="err">+</span> <span class="s2">&quot; - &quot;</span> <span class="err">+</span> <span class="err">res.message);</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>        <span class="err">});</span>
</span><span class='line'>    <span class="err">});</span>
</span><span class='line'><span class="err">}).listen(</span><span class="mi">1337</span><span class="err">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>This code merely pulls any static files and servers them. It requires that you use naming conventions like index.html to make sure that a file is pulled up via &lsquo;/&rsquo;.  You also can call other pages just like you would on a normal apache server.
The final part of this is configuring Bogart to use Http-proxy so that we can load the static pages only when we want to.
 To load http-proxy we need these two lines:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='json'><span class='line'><span class="err">var</span> <span class="err">http</span> <span class="err">=</span> <span class="err">require(&#39;http&#39;)</span>
</span><span class='line'><span class="err">,</span> <span class="err">httpProxy</span> <span class="err">=</span> <span class="err">require(&#39;http-proxy&#39;);</span>
</span></code></pre></td></tr></table></div></figure>


<p> Then to use a proxy, we need this line:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='json'><span class='line'>  <span class="err">router.get(&#39;/&#39;,</span> <span class="err">function(req)</span> <span class="p">{</span>
</span><span class='line'>  <span class="err">return</span> <span class="err">bogart.proxy(&#39;http://127.0.0.1:1337&#39;);</span>
</span><span class='line'><span class="p">}</span><span class="err">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>Remember that the static app is running on port 1337.
 Well that is all for now.  I will be working on the other parts of this experiment and write more on it later.</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog/page/2/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
  </div>
</div>
<aside class="sidebar">
  
    
<section>
	<span>
		<img src="http://www.gravatar.com/avatar/ccb5d4d24f11aa4bf8388dab7051ef38" alt="Gravatar of weatheredwatcher " title="Gravatar of weatheredwatcher" />
	</span>
</section>
<section>
  <h1>About Me</h1>
  <p>Born in 1981 and creating chaos ever since.  Father.  Geek.  Free Software Enthusist</p>
</section>
<section id="badges">
      <a href="http://debian.org/"><img src="http://www.debian.org/logos/button-mini.png"></a>
	    <a href="http://fedoraproject.org/"><img src="images/fedora_button.png" alt=""></a>
	    <a href="http://www.catb.org/hacker-emblem/"><img src="http://www.weatheredwatcher.com/img/hacker.png" alt=""></a>
	    <a href="http://creativecommons.org/licenses/by-sa/3.0/"><img src="http://www.weatheredwatcher.com/img/cc-license_80x15.png" alt=""></a>
</section>
<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2014/08/23/server-stuff-a-developer-needs-to-know/">Server Stuff a Developer Needs to Know (part 1)</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/08/07/devops-building-projects-with-ant/">DevOps: Bulding Projects with Ant</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/07/02/using-zend-config-files-everywhere/">Using Zend Style Config Files Everywhere</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/02/01/preparing-a-dev-environment-with-puppet/">Preparing a Dev Environment with Puppet</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/01/24/running-multiple-apps-on-nodejs/">Running Multiple Apps On NodeJs</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
  <a href="https://github.com/weatheredwatcher">@weatheredwatcher</a> on GitHub
  
  <script type="text/javascript">
    $.domReady(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'weatheredwatcher',
            count: 5,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>

<section>
  <h1>Latest Tweets</h1>
<a class="twitter-timeline"  href="https://twitter.com/DavidDuggins"  data-widget-id="469096456695980032">Tweets by @DavidDuggins</a>
    <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+"://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>


</section>
<section>
  <h2> Coding Playlist </h2>
<iframe src="https://embed.spotify.com/?uri=spotify:user:weatheredwatcher:playlist:5xsZotbtCqUi9BdmXzPJhC" width="250" height="330" frameborder="0" allowtransparency="true"></iframe>
</section>
<section id="fedora_badge">
  <a href="http://fedoraproject.com/en_GB/get-fedora"><img alt="Fedora 20 Heisenbug is here!" src="http://fedoraproject.org/static/images/banners/f20release.png"></a>
</section>
<section id="conferencs">
   <a href="http://www.northeastphp.org"><img src="http://www.northeastphp.org/boston_conference/img/logo.png" alt="I'm Speaking at NEPHP Conference, Boston" border="0"></a>
</section>



  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2014 - weatheredwatcher -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'weatheredwatcher';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
